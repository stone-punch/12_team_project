<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PETOPIA</title>
    <link rel="stylesheet" href="./CSS/CSS_reset.css">
    <link rel="stylesheet" href="./CSS/login.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>

<body>
    <div id="main-screen">
        <div class="grid">
             <img src="./Images/logo.png" alt="PETOPIA">
        </div>
    </div>
<!--login-form-->
    <div id="login-form">
         <form>
            <input id="id" type="text" name="email" class="text-field" placeholder="아이디">
            <input id="password" type="password" name="password" class="text-field" placeholder="비밀번호">
            <input id="subBtn" type="button" value="로그인" class="submit-btn">
        </form>
<!--    //login-form-->

<!--    links-->
        <div class="links">
            <ul>
                <li><a href="./signup.html">회원가입</a></li>
                <li><a href="#">비밀번호를 잊어버리셨나요?</a></li>
            </ul>

        </div>
    </div>
<!--    //links-->

        <div class="main-link"><a href="main.html">Main버튼</a></div>


<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
   
    const firebaseConfig = {
        apiKey: "AIzaSyBdHq8r4EMKfC1d3kug8xOnv14Ui-TA_Hg",
        authDomain: "petper-14f9d.firebaseapp.com",
        databaseURL: "https://petper-14f9d-default-rtdb.firebaseio.com",
        projectId: "petper-14f9d",
        storageBucket: "petper-14f9d.appspot.com",
        messagingSenderId: "382691123578",
        appId: "1:382691123578:web:975408487ddb2e5fde76c3",
        measurementId: "G-71HYZ44KRJ"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    import { getDatabase, ref, set, child, get, update, remove } 

        from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";

    const db = getDatabase();

    const id = document.getElementById('id');
    const password = document.getElementById('password');
    const submit = document.getElementById('subBtn');


    function AuthenticateUser(){
        const dbref = ref(db);

        get(child(dbref, "UsersList/"+ id.value)).then((snapshot)=>{
            if(snapshot.exists()){
                let dbpass = decPass(snapshot.val().password);
                if(dbpass == password.value){
                    login(snapshot.val());
                }

                else{
                    alert("비밀번호가 잘못되었습니다.");
                }
            }

            else{
                alert("존재하지 않는 아이디입니다.")
            }
        });
    }

    function decPass(dbpass){
        var pass12 = CryptoJS.AES.decrypt(dbpass, password.value);
        return pass12.toString(CryptoJS.enc.Utf8);
    }

    function login(user){
        sessionStorage.setItem('user', JSON.stringify(user));
        window.location="main.html";
    }

    submit.addEventListener('click', AuthenticateUser);

</script>


</body>

</html>